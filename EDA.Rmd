---
title: "EDA"
author: "Tianci Zhu"
output:  
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
---

```{r setup, include=FALSE}
library(dplyr)
library(tidyverse)
library(plotly)
```

## Clean data
```{r}
tornado_data <- read.csv("D:/rdata/1950-2023_actual_tornadoes.csv", na.strings = c("NA", "N/A", " "))

cleaned <- tornado_data |>
  filter(yr >= 2000) |>
  select(-tz, -stf, -ns, -sn, -sg, -f1, -f2, -f3, -f4) |>
  relocate(fc, .after = mag)|>
  drop_na()
  
# Optional
write.csv(cleaned, "cleaned_df.csv", row.names = FALSE)
```

```{r}
summary(cleaned)
```

- Most tornadoes have minimal impacts, with many records showing zero injuries, fatalities, or losses.
- A few extreme events contribute significantly to the maximum values in injuries, fatalities, and losses.
- Tornado path dimensions show high variability, with extreme widths and lengths in rare cases.

```{r}
skimr::skim(cleaned)  
```

#### **Magnitude (`mag`)**:
- Mean magnitude is 0.24, indicating that the majority of tornadoes are mild (EF0-EF2).
- The dataset includes a small percentage of extreme events (EF3-EF5), which likely contribute to severe damages.

#### **Path Dimensions (`len`, `wid`)**:
- Tornadoes typically have short paths, with most being less than 2 miles in length. However, a few extend up to 168.5 miles.
- Path widths show greater variability, with a median of 50 yards and rare cases exceeding 4,500 yards.

#### Concluding Observations
- **Low-impact majority**: Most tornadoes in the dataset result in no injuries, fatalities, or monetary losses.
- **Skewed distributions**: A small number of high-impact tornadoes dominate the dataset's extreme values.
- **Path variability**: Tornado paths show significant variability, with a few spanning extraordinary lengths and widths.
- **Data completeness**: The cleaned dataset is complete, with no missing values in any variable, enabling robust exploratory analysis.


## EDA

### Which states have experienced the highest cumulative property losses due to tornadoes?
```{r}
# States with highest average property loss per tornado
state_property_loss <- cleaned |>
  group_by(st) |>
  summarize(avg_loss = mean(loss, na.rm = TRUE)) |>
  arrange(desc(avg_loss)) |>
  slice(1:10) |>
  plot_ly(x = ~st, y = ~avg_loss, type = 'bar') |>
  layout(title = "Top 10 States with Highest Average Property Loss",
         xaxis = list(title = "State"),
         yaxis = list(title = "Average Property Loss (Millions)"))
state_property_loss
```

- **Tennessee (TN)** has the highest average property loss, exceeding **2.5 million dollars**, significantly more than other states.
- **Ohio (OH)** and **North Carolina (NC)** follow with average losses over **1 million dollars**.
- **Louisiana (LA)**, **Arkansas (AR)**, and **Texas (TX)** report moderate losses between **0.5 and 1 million dollars**.
- The variability suggests that factors like infrastructure and tornado intensity contribute to these differences.

### What is the relationship between tornado path length, path width, and property loss?
```{r}
# Correlation between path length, width, and property loss
corr <- cleaned |>
  plot_ly(x = ~len, y = ~wid, z = ~loss, color = ~mag) |>
  add_markers() |>
  layout(title = "Correlation Between Path Length, Width, and Property Loss",
         scene = list(xaxis = list(title = "Path Length (miles)"),
                      yaxis = list(title = "Path Width (yards)"),
                      zaxis = list(title = "Property Loss (Millions)")))
corr
```

- Tornadoes with longer paths and wider widths are more likely to result in higher property losses, as shown by the clustering of points in the upper-right corner of the plot.
- Property losses are generally concentrated below **$500 million**, but a few events exceed **$1 billion**.
- Higher magnitude tornadoes (indicated by warmer colors such as yellow) are associated with larger property losses and damages.


### What is the total number of tornadoes for each state?
```{r}
state_tornado_count_map <- cleaned |>
  group_by(st) |>
  summarize(total_tornadoes = n()) |>
  plot_ly(
    type = 'choropleth',
    locations = ~st,
    locationmode = 'USA-states',
    z = ~total_tornadoes,
    colorscale = "Viridis", 
    zmin = 0,               
    zmax = max(cleaned$st, na.rm = TRUE), 
    colorbar = list(title = "Total Tornadoes")
  ) |>
  layout(
    title = "Total Tornado Numbers by State",
    geo = list(scope = "usa")
  )

state_tornado_count_map
```

- **Texas (TX)** has the highest tornado count, exceeding **3,000**, reflecting its large size and frequent exposure to tornado-prone weather patterns.
- States in **Tornado Alley**, such as **Oklahoma (OK)**, **Kansas (KS)**, and **Nebraska (NE)**, also exhibit high tornado frequencies.
- **Eastern states**, including **Mississippi (MS)** and **Alabama (AL)**, show moderate tornado counts.
- **Western states**, such as **Nevada (NV)** and **California (CA)**, have the lowest tornado counts due to less favorable conditions for tornado formation.

### What is the total property loss for each state?
```{r}
state_loss_map <- cleaned |>
  group_by(st) |>
  summarize(total_loss = sum(loss, na.rm = TRUE)) |>
  plot_ly(
    type = 'choropleth',
    locations = ~st,
    locationmode = 'USA-states',
    z = ~total_loss,
    colorscale = "Viridis", 
    zmin = 0,               
    zmax = max(cleaned$loss, na.rm = TRUE), 
    colorbar = list(title = "Total Loss (Millions)")
  ) |>
  layout(
    title = "Total Property Loss by State",
    geo = list(scope = "usa")
  )

state_loss_map
```

- **Texas (TX)** reports the highest total property loss, exceeding **$1.5 billion**, due to its frequent tornado activity and large impacted areas.
- **Tennessee (TN)** also exhibits significant losses, reflecting specific high-damage events during the observed period.
- **Southeastern states**, including **Mississippi (MS)** and **Alabama (AL)**, show moderate property losses.
- **Western and Northeastern states** generally experience the lowest total losses, likely due to lower tornado frequencies and intensities in these regions.

